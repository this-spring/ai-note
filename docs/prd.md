# AI-Note 产品需求文档 (PRD)

**版本**: v1.0
**日期**: 2026-02-08
**状态**: 评审中

---

## 一、项目概述

### 1.1 项目背景

当前市面上的笔记应用（如 Notion、语雀、Obsidian）普遍存在以下痛点：

- 云端存储依赖网络，存在数据隐私和服务关停风险
- 私有格式导致数据迁移困难
- 版本管理能力薄弱，缺少细粒度的历史追溯

AI-Note 定位为一款**本地优先（Local-First）**的 Markdown 笔记桌面应用。所有数据以标准 Markdown 文件形式存储在用户本地文件系统中，通过内置 Git 进行版本管理，确保用户对数据拥有完全的控制权。

### 1.2 目标用户

| 用户画像            | 核心诉求                                                          |
| ------------------- | ----------------------------------------------------------------- |
| 开发者 / 技术写作者 | 熟悉 Markdown 语法，需要源码编辑模式，对 Git 版本控制有天然亲和力 |
| 知识管理爱好者      | 需要高效的笔记组织、标签分类和全文搜索能力                        |
| 隐私敏感用户        | 要求数据完全本地存储，不依赖第三方云服务                          |
| 学生 / 研究人员     | 需要长期积累笔记并能方便地回溯和对比历史版本                      |

### 1.3 核心价值主张

1. **数据主权**: 所有笔记以标准 `.md` 文件存储在本地，用户可用任何文本编辑器打开，零锁定
2. **版本可追溯**: 内置 Git 版本管理，每次编辑都有历史记录，支持精确回滚
3. **双模编辑**: WYSIWYG 所见即所得模式降低门槛，源码模式满足高级用户需求
4. **高效组织**: 文件夹 + 标签双维度管理笔记，全文搜索快速定位内容

---

## 二、技术选型

| 层级            | 技术                        | 理由                                                         |
| --------------- | --------------------------- | ------------------------------------------------------------ |
| 应用框架        | Electron                    | 跨平台桌面应用，直接访问本地文件系统                         |
| 前端 UI         | React 18+ / TypeScript      | 组件化开发，类型安全                                         |
| 构建工具        | electron-vite               | 快速 HMR，现代构建体系                                       |
| Markdown 编辑器 | Milkdown (基于 ProseMirror) | 原生 Markdown 输入/输出，插件化架构，支持 WYSIWYG 与源码切换 |
| Git 操作        | isomorphic-git              | 纯 JavaScript 实现，无需系统安装 Git，跨平台一致性           |
| 全文搜索        | FlexSearch                  | 高性能零依赖全文搜索引擎，支持中文分词                       |
| 本地数据库      | SQLite (better-sqlite3)     | 存储标签、元数据、搜索索引等结构化数据                       |
| 状态管理        | Zustand                     | 轻量级状态管理，适合 Electron 渲染进程                       |
| 样式方案        | Tailwind CSS                | 工具类优先，快速 UI 开发                                     |

---

## 三、功能需求

### 3.1 笔记管理模块

#### 3.1.1 创建笔记

| 编号   | 功能点             | 详细描述                                                                  | 优先级 |
| ------ | ------------------ | ------------------------------------------------------------------------- | ------ |
| NM-001 | 新建 Markdown 文件 | 在任意文件夹下创建 `.md` 文件，需指定文件名（自动添加 `.md` 后缀）        | P0     |
| NM-002 | 默认模板           | 新建笔记时自动填充基础 YAML Front Matter（title, created, updated, tags） | P0     |
| NM-003 | 快捷新建           | 全局快捷键 `Cmd/Ctrl+N` 快速新建笔记，创建在当前选中的文件夹下            | P0     |
| NM-004 | 从模板创建         | 提供可自定义的笔记模板库，用户可基于模板创建特定格式的笔记                | P2     |

**笔记文件结构规范**:

```markdown
---
title: 笔记标题
created: 2026-02-08T12:00:00+08:00
updated: 2026-02-08T12:00:00+08:00
tags:
  - tag1
  - tag2
---

笔记正文内容...
```

#### 3.1.2 编辑笔记

| 编号   | 功能点     | 详细描述                                                     | 优先级 |
| ------ | ---------- | ------------------------------------------------------------ | ------ |
| NM-010 | 打开编辑   | 单击文件树或搜索结果中的笔记打开编辑区                       | P0     |
| NM-011 | 自动保存   | 编辑后自动保存至文件系统，延迟时间可配（默认 1 秒 debounce） | P0     |
| NM-012 | 多标签页   | 同时打开多个笔记，以标签页形式展示，支持拖拽排序             | P1     |
| NM-013 | 未保存标记 | 标签页上显示未保存状态的视觉提示（如圆点标记）               | P0     |
| NM-014 | 关闭确认   | 关闭含未保存内容的标签页时弹出确认对话框                     | P0     |

#### 3.1.3 删除笔记

| 编号   | 功能点       | 详细描述                                                          | 优先级 |
| ------ | ------------ | ----------------------------------------------------------------- | ------ |
| NM-020 | 删除到回收站 | 删除操作将文件移至应用内回收站（`.ai-note/trash/`），而非直接删除 | P1     |
| NM-021 | 永久删除     | 从回收站中彻底删除文件                                            | P1     |
| NM-022 | 恢复文件     | 从回收站恢复笔记到原始位置                                        | P1     |
| NM-023 | 批量删除     | 支持多选文件后批量删除                                            | P2     |

#### 3.1.4 移动与重命名

| 编号   | 功能点       | 详细描述                                                        | 优先级 |
| ------ | ------------ | --------------------------------------------------------------- | ------ |
| NM-030 | 重命名文件   | 右键菜单或 F2 触发重命名，自动同步 Front Matter 中的 title 字段 | P0     |
| NM-031 | 拖拽移动     | 在文件树中拖拽笔记到目标文件夹完成移动                          | P1     |
| NM-032 | 右键移动     | 右键菜单 -> "移动到..." 弹出文件夹选择器                        | P1     |
| NM-033 | 引用自动更新 | 移动或重命名后自动更新其他笔记中对该文件的引用                  | P2     |

---

### 3.2 Markdown 编辑器模块

#### 3.2.1 WYSIWYG 所见即所得模式

| 编号   | 功能点       | 详细描述                                                                                                              | 优先级 |
| ------ | ------------ | --------------------------------------------------------------------------------------------------------------------- | ------ |
| ME-001 | 实时渲染     | 输入 Markdown 语法后立即渲染为富文本格式展示                                                                          | P0     |
| ME-002 | 工具栏       | 格式化工具栏：加粗、斜体、删除线、标题级别（H1-H6）、有序列表、无序列表、待办列表、引用块、分割线、代码块、链接、图片 | P0     |
| ME-003 | 快捷键支持   | 常用格式快捷键（`Cmd/Ctrl+B` 加粗、`Cmd/Ctrl+I` 斜体等）                                                              | P0     |
| ME-004 | 斜杠命令     | 输入 `/` 触发命令面板，快速插入各类内容块                                                                             | P1     |
| ME-005 | 拖拽插入图片 | 拖拽或粘贴图片，自动保存到笔记同级 `assets/` 目录并插入引用                                                           | P1     |

#### 3.2.2 源码编辑模式

| 编号   | 功能点       | 详细描述                                         | 优先级 |
| ------ | ------------ | ------------------------------------------------ | ------ |
| ME-010 | 语法高亮     | Markdown 源码语法高亮显示（基于 CodeMirror 6）   | P0     |
| ME-011 | 行号显示     | 源码模式左侧显示行号                             | P0     |
| ME-012 | 代码折叠     | 按标题层级或代码块进行折叠/展开                  | P1     |
| ME-013 | 括号匹配     | 自动匹配 `()` `[]` `{}` 等括号                   | P1     |
| ME-014 | 实时预览面板 | 源码模式下可选择开启右侧实时预览面板（分屏预览） | P2     |

#### 3.2.3 模式切换

| 编号   | 功能点       | 详细描述                                          | 优先级 |
| ------ | ------------ | ------------------------------------------------- | ------ |
| ME-020 | 一键切换     | 编辑器右上角切换按钮，WYSIWYG / 源码 两种模式切换 | P0     |
| ME-021 | 快捷键切换   | `Cmd/Ctrl+Shift+M` 快速切换编辑模式               | P0     |
| ME-022 | 状态无损     | 切换时保持光标位置、滚动位置和编辑内容不丢失      | P0     |
| ME-023 | 默认模式记忆 | 记住用户上次使用的编辑模式作为下次默认            | P1     |

#### 3.2.4 支持的 Markdown 语法

| 分类         | 语法元素                                      | 优先级 |
| ------------ | --------------------------------------------- | ------ |
| 基础文本     | 标题 (H1-H6)、加粗、斜体、删除线、行内代码    | P0     |
| 段落结构     | 段落、换行、水平分割线、引用块（支持嵌套）    | P0     |
| 列表         | 有序列表、无序列表、待办列表（checkbox）      | P0     |
| 链接与媒体   | 超链接、图片（含 alt 和 title）、本地图片引用 | P0     |
| 代码         | 行内代码、围栏代码块（含语言标注的语法高亮）  | P0     |
| 表格         | GFM 风格表格（含对齐控制）                    | P0     |
| Front Matter | YAML Front Matter 解析与编辑                  | P0     |
| 扩展语法     | 脚注、上标/下标                               | P1     |
| 数学公式     | 行内 `$...$`、块级 `$$...$$`（KaTeX 渲染）    | P1     |
| 图表         | Mermaid 流程图/时序图/甘特图渲染              | P2     |
| 笔记特有     | `[[wikilink]]` 双向链接语法                   | P2     |

---

### 3.3 文件夹 / 目录管理模块

#### 3.3.1 文件树

| 编号   | 功能点       | 详细描述                                       | 优先级 |
| ------ | ------------ | ---------------------------------------------- | ------ |
| FM-001 | 树状展示     | 左侧面板以树状结构展示工作区文件夹和笔记层级   | P0     |
| FM-002 | 展开/折叠    | 点击文件夹图标或箭头展开/折叠子目录            | P0     |
| FM-003 | 文件类型图标 | 根据文件类型和文件夹状态显示对应图标           | P1     |
| FM-004 | 当前文件高亮 | 当前编辑的文件在文件树中高亮显示               | P0     |
| FM-005 | 文件树搜索   | 文件树顶部快速过滤输入框，按文件名模糊匹配过滤 | P1     |

#### 3.3.2 文件夹操作

| 编号   | 功能点       | 详细描述                                     | 优先级 |
| ------ | ------------ | -------------------------------------------- | ------ |
| FM-010 | 新建文件夹   | 右键菜单或工具栏按钮创建新文件夹，支持嵌套   | P0     |
| FM-011 | 重命名文件夹 | 右键菜单或 F2 重命名                         | P0     |
| FM-012 | 删除文件夹   | 删除文件夹（含确认提示），内部笔记移至回收站 | P0     |
| FM-013 | 拖拽排序     | 同级文件夹/文件拖拽调整显示顺序              | P2     |
| FM-014 | 拖拽嵌套     | 将文件夹拖拽到另一个文件夹中                 | P1     |

#### 3.3.3 工作区管理

| 编号   | 功能点       | 详细描述                                                         | 优先级 |
| ------ | ------------ | ---------------------------------------------------------------- | ------ |
| FM-020 | 打开工作区   | 选择一个本地文件夹作为笔记工作区（即 Git 仓库根目录）            | P0     |
| FM-021 | 最近工作区   | 记住并展示最近打开过的工作区列表                                 | P1     |
| FM-022 | 切换工作区   | 支持在多个工作区之间快速切换                                     | P1     |
| FM-023 | 工作区初始化 | 首次打开空文件夹时自动初始化 Git 仓库，创建 `.ai-note/` 配置目录 | P0     |

---

### 3.4 Git 版本控制模块

#### 3.4.1 仓库管理

| 编号    | 功能点         | 详细描述                                                        | 优先级 |
| ------- | -------------- | --------------------------------------------------------------- | ------ |
| GIT-001 | 自动初始化     | 打开工作区时检测是否为 Git 仓库，若不是则自动 `git init`        | P0     |
| GIT-002 | gitignore 管理 | 自动创建/维护 `.gitignore`，忽略 `.ai-note/`、`node_modules` 等 | P0     |
| GIT-003 | 仓库状态展示   | 状态栏显示当前分支名、是否有未提交更改                          | P1     |

#### 3.4.2 自动提交

| 编号    | 功能点         | 详细描述                                                                        | 优先级 |
| ------- | -------------- | ------------------------------------------------------------------------------- | ------ |
| GIT-010 | 保存时自动暂存 | 文件保存后自动执行 `git add`                                                    | P0     |
| GIT-011 | 自动提交策略   | 可配置：(a) 每次保存后立即提交；(b) 定时批量提交（默认每5分钟）；(c) 仅手动提交 | P0     |
| GIT-012 | 自动提交消息   | 格式：`auto: update <filename> at <timestamp>`                                  | P0     |
| GIT-013 | 手动提交       | 支持手动触发提交，可自定义 commit message                                       | P1     |

#### 3.4.3 版本历史

| 编号    | 功能点          | 详细描述                                                   | 优先级 |
| ------- | --------------- | ---------------------------------------------------------- | ------ |
| GIT-020 | 文件历史列表    | 查看单个文件的所有 commit 历史，展示时间和 commit message  | P0     |
| GIT-021 | 版本预览        | 点击历史记录中的某个版本，预览该版本完整内容（只读）       | P0     |
| GIT-022 | 版本对比 (Diff) | 选择两个版本进行逐行对比，inline diff 或 side-by-side diff | P0     |
| GIT-023 | 与当前版本对比  | 快速将任意历史版本与当前版本对比                           | P1     |
| GIT-024 | 全局历史        | 查看整个工作区的 commit 历史时间线                         | P2     |

#### 3.4.4 版本回滚

| 编号    | 功能点     | 详细描述                                     | 优先级 |
| ------- | ---------- | -------------------------------------------- | ------ |
| GIT-030 | 文件级回滚 | 将单个文件回滚到指定历史版本                 | P0     |
| GIT-031 | 回滚确认   | 回滚前弹出确认对话框，展示将被覆盖的内容摘要 | P0     |
| GIT-032 | 回滚记录   | 回滚操作本身产生一次新 commit，确保可追溯    | P0     |

#### 3.4.5 分支管理（远期）

| 编号    | 功能点   | 详细描述               | 优先级 |
| ------- | -------- | ---------------------- | ------ |
| GIT-040 | 查看分支 | 查看所有本地分支       | P2     |
| GIT-041 | 创建分支 | 基于当前分支创建新分支 | P2     |
| GIT-042 | 切换分支 | 在分支之间切换         | P2     |
| GIT-043 | 合并分支 | 将分支合并回主分支     | P3     |

---

### 3.5 全文搜索模块

#### 3.5.1 搜索范围与方式

| 编号   | 功能点   | 详细描述                                       | 优先级 |
| ------ | -------- | ---------------------------------------------- | ------ |
| FS-001 | 全局搜索 | 搜索范围覆盖当前工作区所有 `.md` 文件正文内容  | P0     |
| FS-002 | 搜索入口 | 侧边栏搜索面板 + 全局快捷键 `Cmd/Ctrl+Shift+F` | P0     |
| FS-003 | 实时搜索 | 输入关键词时实时展示匹配结果（debounce 300ms） | P0     |
| FS-004 | 模糊匹配 | 支持模糊匹配，容忍少量拼写差异                 | P1     |
| FS-005 | 中文搜索 | 完善的中文分词支持                             | P0     |
| FS-006 | 搜索过滤 | 按文件夹范围、标签、时间范围过滤搜索结果       | P2     |

#### 3.5.2 结果展示

| 编号   | 功能点     | 详细描述                                                     | 优先级 |
| ------ | ---------- | ------------------------------------------------------------ | ------ |
| FS-010 | 结果列表   | 按相关度排序：文件名、匹配文本片段（关键词高亮）、所属文件夹 | P0     |
| FS-011 | 结果计数   | 显示匹配文件总数和匹配条目总数                               | P0     |
| FS-012 | 点击跳转   | 点击结果打开笔记并滚动到匹配位置，匹配文本高亮               | P0     |
| FS-013 | 上下文预览 | 每条结果展示匹配行的上下文（前后各 1-2 行）                  | P1     |

#### 3.5.3 搜索索引

| 编号   | 功能点         | 详细描述                                                      | 优先级 |
| ------ | -------------- | ------------------------------------------------------------- | ------ |
| FS-020 | 启动时构建索引 | 应用启动时扫描所有 `.md` 文件并构建搜索索引                   | P0     |
| FS-021 | 增量更新索引   | 文件保存/创建/删除/移动时增量更新索引                         | P0     |
| FS-022 | 文件监听       | 通过 chokidar 监听文件系统变更，自动触发索引更新              | P0     |
| FS-023 | 索引持久化     | 将索引序列化存储至 `.ai-note/search-index/`，避免每次全量重建 | P1     |

---

### 3.6 标签系统模块

#### 3.6.1 标签管理

| 编号   | 功能点           | 详细描述                                              | 优先级 |
| ------ | ---------------- | ----------------------------------------------------- | ------ |
| TG-001 | 创建标签         | 在笔记 Front Matter 中添加标签：`tags: [tag1, tag2]`  | P0     |
| TG-002 | 编辑器内添加标签 | 编辑器底部/顶部标签区域，输入框快速添加/移除标签      | P0     |
| TG-003 | 标签自动补全     | 输入标签时自动补全已有标签                            | P1     |
| TG-004 | 标签重命名       | 全局重命名标签，自动更新所有笔记 Front Matter         | P1     |
| TG-005 | 标签删除         | 全局删除标签，从所有笔记中移除                        | P1     |
| TG-006 | 标签颜色         | 为标签设置自定义颜色（存储在 `.ai-note/config.json`） | P2     |

#### 3.6.2 标签浏览与筛选

| 编号   | 功能点         | 详细描述                               | 优先级 |
| ------ | -------------- | -------------------------------------- | ------ |
| TG-010 | 标签面板       | 侧边栏标签面板，展示所有标签及笔记数量 | P0     |
| TG-011 | 按标签筛选     | 点击标签筛选出该标签下的所有笔记       | P0     |
| TG-012 | 多标签交叉筛选 | 选择多个标签进行 AND/OR 组合筛选       | P2     |
| TG-013 | 标签云         | 以标签云形式展示，字号反映使用频率     | P3     |

#### 3.6.3 标签数据存储策略

- **权威来源**: 每个笔记 YAML Front Matter 中的 `tags` 字段为唯一权威来源
- **缓存索引**: SQLite 数据库维护标签到文件的映射索引，加速查询，与 Front Matter 保持同步

---

## 四、用户界面设计

### 4.1 整体布局

```
+-----------------------------------------------------------------------+
|  菜单栏 (macOS: 系统菜单 / Windows: 应用内菜单)                          |
+-------+---------------------------+-----------------------------------+
|       |      标签页栏              |                                   |
| 侧    |  [笔记A] [笔记B*] [+]     |         [WYSIWYG | 源码]          |
| 边    +---------------------------+-----------------------------------+
| 栏    |  工具栏                                                        |
|       |  B I S H1▾ • - [] " — </>                                     |
| ┌───┐ +---------------------------------------------------------------+
| |文件| |                                                               |
| |树  | |                                                               |
| |   | |                     编辑器主区域                                |
| |   | |                                                               |
| +---+ |                                                               |
| |搜索| |                                                               |
| |   | |                                                               |
| +---+ |                                                               |
| |标签| |                                                               |
| |   | |                                                               |
| +---+ +---------------------------------------------------------------+
| |Git | |  状态栏: [main] [字数: 1234] [行 12, 列 8] [UTF-8] [自动保存] |
| └───┘ +---------------------------------------------------------------+
+-------+---------------------------------------------------------------+
```

### 4.2 侧边栏面板

侧边栏宽度可拖拽调整（默认 260px，最小 200px，最大 400px），包含四个可切换面板：

**面板一：文件树 (Explorer)**

- 顶部：工作区名称 + 新建文件/文件夹按钮
- 文件名快速过滤输入框
- 树形目录，支持展开/折叠、右键上下文菜单
- 文件夹在前、文件在后，按名称字母排序

**面板二：搜索 (Search)**

- 搜索输入框（含清除按钮）
- 高级过滤选项（折叠区域）
- 搜索结果列表：文件名 + 匹配片段预览 + 匹配计数
- 点击结果跳转

**面板三：标签 (Tags)**

- 所有标签列表，每个标签后显示笔记数量
- 点击标签筛选笔记
- 标签管理入口

**面板四：Git 历史 (Version Control)**

- 当前文件的 commit 历史列表
- 每条记录：commit message + 相对时间
- 点击查看版本内容或与当前版本 Diff
- 回滚操作按钮

### 4.3 编辑器主区域

- **标签页栏**: 水平排列已打开笔记标签页，支持拖拽排序、中键关闭、右键菜单
- **工具栏**: 仅在 WYSIWYG 模式下显示；源码模式下隐藏
- **编辑区**: 占据主区域大部分空间，支持自适应宽度（可配最大宽度，居中显示）
- **标签编辑区**: 编辑器底部显示当前笔记标签列表，可快速添加/移除

### 4.4 状态栏

底部状态栏从左到右展示：

- Git 当前分支名 + 修改状态指示
- 文档字数统计
- 光标位置（行号、列号）
- 文件编码（UTF-8）
- 自动保存状态
- 编辑模式指示（WYSIWYG / 源码）

### 4.5 快捷键总览

| 操作         | macOS         | Windows/Linux         |
| ------------ | ------------- | --------------------- |
| 新建笔记     | `Cmd+N`       | `Ctrl+N`              |
| 保存         | `Cmd+S`       | `Ctrl+S`              |
| 全局搜索     | `Cmd+Shift+F` | `Ctrl+Shift+F`        |
| 快速打开文件 | `Cmd+P`       | `Ctrl+P`              |
| 切换编辑模式 | `Cmd+Shift+M` | `Ctrl+Shift+M`        |
| 切换侧边栏   | `Cmd+B`       | `Ctrl+B`              |
| 关闭当前标签 | `Cmd+W`       | `Ctrl+W`              |
| 加粗         | `Cmd+B`       | `Ctrl+B` (编辑器焦点) |
| 斜体         | `Cmd+I`       | `Ctrl+I`              |
| 命令面板     | `Cmd+Shift+P` | `Ctrl+Shift+P`        |

---

## 五、非功能需求

### 5.1 性能要求

| 编号    | 指标           | 目标值                 |
| ------- | -------------- | ---------------------- |
| NF-P001 | 应用启动时间   | < 3 秒                 |
| NF-P002 | 笔记打开时间   | < 500ms                |
| NF-P003 | 搜索响应时间   | < 200ms（万级文件）    |
| NF-P004 | 编辑器输入延迟 | < 50ms                 |
| NF-P005 | 大文件支持     | > 100KB 无明显卡顿     |
| NF-P006 | 内存占用       | < 500MB（10 个标签页） |
| NF-P007 | 工作区规模     | 10,000+ 文件正常工作   |

### 5.2 安全性要求

| 编号    | 要求                                                                 |
| ------- | -------------------------------------------------------------------- |
| NF-S001 | 所有数据仅存储在本地，不向远程服务器发送数据                         |
| NF-S002 | 禁用 `nodeIntegration`、启用 `contextIsolation`、使用 `preload` 脚本 |
| NF-S003 | 主进程和渲染进程通过白名单化的 IPC channel 通信                      |
| NF-S004 | 应用仅访问用户显式选择的工作区目录                                   |
| NF-S005 | 定期审查第三方依赖安全漏洞                                           |

### 5.3 可用性要求

| 编号    | 要求                                 |
| ------- | ------------------------------------ |
| NF-U001 | 所有核心操作可通过键盘快捷键完成     |
| NF-U002 | 快捷键自定义                         |
| NF-U003 | 深色/浅色主题，可跟随系统自动切换    |
| NF-U004 | 编辑器字体、字号自定义               |
| NF-U005 | 窗口大小、位置、侧边栏宽度等状态记忆 |
| NF-U006 | 支持拖拽操作                         |

### 5.4 兼容性要求

| 编号    | 要求                                  |
| ------- | ------------------------------------- |
| NF-C001 | macOS 12+、Windows 10+、Ubuntu 20.04+ |
| NF-C002 | 完全兼容 CommonMark 和 GFM 规范       |
| NF-C003 | Git 仓库可被标准 Git 客户端正常操作   |
| NF-C004 | `.md` 文件可被任何文本编辑器正常打开  |

---

## 六、MVP 范围定义

### 6.1 第一版本（P0）

| 模块     | 功能                                                                   |
| -------- | ---------------------------------------------------------------------- |
| 工作区   | 打开本地文件夹作为工作区，自动初始化 Git 仓库                          |
| 文件树   | 树状展示、展开/折叠、当前文件高亮                                      |
| 文件管理 | 新建/删除/重命名笔记和文件夹                                           |
| 编辑器   | WYSIWYG 模式 + 源码模式 + 一键切换                                     |
| 编辑器   | 基础 Markdown 语法（标题、列表、代码、链接、图片、表格、Front Matter） |
| 编辑器   | 格式化工具栏 + 常用快捷键                                              |
| 编辑器   | 自动保存到文件系统                                                     |
| Git      | 自动初始化仓库 + .gitignore 管理                                       |
| Git      | 保存时自动暂存 + 可配置自动提交                                        |
| Git      | 查看文件 commit 历史                                                   |
| Git      | 版本对比 Diff                                                          |
| Git      | 文件级版本回滚                                                         |
| 搜索     | 全局全文搜索 + 中文支持                                                |
| 搜索     | 结果列表展示 + 点击跳转                                                |
| 搜索     | 启动时构建索引 + 增量更新                                              |
| 标签     | Front Matter 管理标签                                                  |
| 标签     | 标签面板 + 按标签筛选                                                  |
| 设置     | 自动保存间隔、默认编辑模式、主题切换                                   |

### 6.2 第二版本（P1）

- 多标签页编辑
- 笔记模板
- 拖拽移动文件/文件夹
- 手动提交 + 自定义 commit message
- 搜索上下文预览
- 标签自动补全、重命名、删除
- 快速打开文件（Cmd+P）
- 代码折叠 + KaTeX 公式
- 最近工作区 + 搜索索引持久化

### 6.3 第三版本（P2/P3）

- Mermaid 图表、`[[wikilink]]` 双向链接
- 多标签交叉筛选、标签颜色、标签云
- Git 分支管理
- 搜索高级过滤
- 拖拽排序、引用自动更新
- 分屏预览

---

## 七、数据模型

### 7.1 工作区目录结构

```
workspace/
├── .git/                     # Git 仓库数据
├── .gitignore                # Git 忽略规则
├── .ai-note/                 # 应用配置目录（被 gitignore）
│   ├── config.json           # 工作区级配置
│   ├── db.sqlite             # 元数据数据库
│   └── search-index/         # 搜索索引缓存
├── folder-a/
│   ├── note-1.md
│   ├── note-2.md
│   └── assets/               # 笔记关联的图片/附件
│       └── image-001.png
└── folder-b/
    └── note-3.md
```

### 7.2 SQLite 数据表

**notes 表**（缓存元数据）:

| 字段         | 类型    | 说明                          |
| ------------ | ------- | ----------------------------- |
| id           | TEXT PK | 文件相对路径                  |
| title        | TEXT    | 笔记标题（来自 Front Matter） |
| created_at   | TEXT    | 创建时间                      |
| updated_at   | TEXT    | 最后修改时间                  |
| content_hash | TEXT    | 文件内容哈希（检测变更）      |

**tags 表**:

| 字段  | 类型        | 说明             |
| ----- | ----------- | ---------------- |
| id    | INTEGER PK  | 自增主键         |
| name  | TEXT UNIQUE | 标签名称         |
| color | TEXT        | 标签颜色（可选） |

**note_tags 表**（多对多）:

| 字段    | 类型    | 说明          |
| ------- | ------- | ------------- |
| note_id | TEXT    | 关联 notes.id |
| tag_id  | INTEGER | 关联 tags.id  |

### 7.3 工作区配置

`.ai-note/config.json`:

```json
{
  "version": 1,
  "editor": {
    "defaultMode": "wysiwyg",
    "autoSaveDelay": 1000,
    "fontSize": 16,
    "fontFamily": "system-ui",
    "maxWidth": 800
  },
  "git": {
    "autoCommit": true,
    "autoCommitInterval": 300000,
    "autoCommitStrategy": "interval"
  },
  "appearance": {
    "theme": "system",
    "sidebarWidth": 260
  },
  "search": {
    "debounceDelay": 300
  }
}
```

---
